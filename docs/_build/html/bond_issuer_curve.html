
<!DOCTYPE html>


<html lang="en" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Read Reference and Market Data &#8212; finpricing  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=eafc0fe6" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'bond_issuer_curve';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Changelog" href="changelog.html" />
    <link rel="prev" title="finpricing" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">finpricing  documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Read Reference and Market Data
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="changelog.html">
                        Changelog
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="contributing.html">
                        Contributing
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="conduct.html">
                        Code of Conduct
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="autoapi/index.html">
                        API Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/YimingZhang07/finpricing" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://yimingzhang.netlify.app/" title="My Website" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-blog fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">My Website</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Read Reference and Market Data
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="changelog.html">
                        Changelog
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="contributing.html">
                        Contributing
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="conduct.html">
                        Code of Conduct
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="autoapi/index.html">
                        API Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/YimingZhang07/finpricing" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://yimingzhang.netlify.app/" title="My Website" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-blog fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">My Website</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Read...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">finpricing.model</span> <span class="kn">import</span> <span class="n">BondCurveAnalyticsHelper</span><span class="p">,</span> <span class="n">BondCurveSolver</span><span class="p">,</span> <span class="n">cds_market_spreads</span>
<span class="kn">from</span> <span class="nn">finpricing.market</span> <span class="kn">import</span> <span class="n">SurvivalCurveStep</span><span class="p">,</span> <span class="n">SurvivalCurveNelsonSiegel</span>
<span class="kn">from</span> <span class="nn">finpricing.utils</span> <span class="kn">import</span> <span class="n">Date</span><span class="p">,</span> <span class="n">prettyTableByColumn</span>
<span class="kn">import</span> <span class="nn">finpricing.utils.instaplot</span> <span class="k">as</span> <span class="nn">isplt</span>
<span class="c1"># this assumes this notebook is running in the /docs folder and the data is in the /tests folder</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;../tests&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">testing_utils.read_data</span> <span class="kn">import</span> <span class="n">get_sample_bonds_portfolio</span><span class="p">,</span> <span class="n">get_sample_discount_curve</span>
</pre></div>
</div>
</div>
</div>
<section id="read-reference-and-market-data">
<h1>Read Reference and Market Data<a class="headerlink" href="#read-reference-and-market-data" title="Link to this heading">#</a></h1>
<p>We pick 10 bonds from the same issuer on 2023-10-09, and fix all the market data accordingly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bonds</span><span class="p">,</span> <span class="n">dirty_prices</span><span class="p">,</span> <span class="n">balance</span> <span class="o">=</span> <span class="n">get_sample_bonds_portfolio</span><span class="p">(</span><span class="n">include_balance</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">discount_curve</span>      <span class="o">=</span> <span class="n">get_sample_discount_curve</span><span class="p">()</span>
<span class="n">valuation_date</span>      <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">settlement_date</span>     <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prettyTableByColumn</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;Bond&#39;</span><span class="p">:</span> <span class="n">bonds</span><span class="p">,</span>
        <span class="s1">&#39;Dirty Price&#39;</span><span class="p">:</span> <span class="n">dirty_prices</span>
    <span class="p">},</span>
    <span class="n">align</span><span class="o">=</span><span class="s1">&#39;lr&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-----------------+--------------------+
| Bond            |        Dirty Price |
+-----------------+--------------------+
| 5.750% 03/01/24 | 100.62719107573301 |
| 5.875% 02/15/25 | 102.85712222222223 |
| 3.625% 06/15/25 |  97.45796188119483 |
| 3.625% 06/15/25 |  97.45796188119483 |
| 4.375% 11/15/26 |  97.87555555555555 |
| 4.875% 04/15/28 |  98.73763333333333 |
| 5.875% 11/15/28 | 102.61128888888888 |
| 6.375% 05/15/29 | 104.84126718711933 |
| 5.375% 11/15/29 |  98.47593444444445 |
| 4.875% 06/15/30 |  95.09173333333334 |
+-----------------+--------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">isplt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">discount_curve</span><span class="o">.</span><span class="n">dates</span><span class="p">,</span>
     <span class="n">y</span><span class="o">=</span><span class="n">discount_curve</span><span class="o">.</span><span class="n">rates</span><span class="p">,</span>
     <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Zero Curve on 2023-10-09&quot;</span><span class="p">,</span>
     <span class="n">x_label</span><span class="o">=</span><span class="s2">&quot;Maturity&quot;</span><span class="p">,</span>
     <span class="n">y_label</span><span class="o">=</span><span class="s2">&quot;Zero Rate&quot;</span><span class="p">,</span>
     <span class="n">y_axis_formatter</span><span class="o">=</span><span class="s2">&quot;percent&quot;</span><span class="p">,</span>
     <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
     <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/64b6fa8c63a48efd12c2d832bf33fd661c497749892befe1d9aafac7ec566a0e.png" src="_images/64b6fa8c63a48efd12c2d832bf33fd661c497749892befe1d9aafac7ec566a0e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span> <span class="n">discount_curve</span><span class="o">.</span><span class="n">discount</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">discount_curve</span><span class="o">.</span><span class="n">dates</span> <span class="p">]</span>
<span class="n">isplt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">discount_curve</span><span class="o">.</span><span class="n">dates</span><span class="p">,</span>
     <span class="n">y</span><span class="o">=</span><span class="n">dfs</span><span class="p">,</span>
     <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Discounting Factors on 2023-10-09 using Flat Forward&quot;</span><span class="p">,</span>
     <span class="n">x_label</span><span class="o">=</span><span class="s2">&quot;Maturity&quot;</span><span class="p">,</span>
     <span class="n">y_label</span><span class="o">=</span><span class="s2">&quot;Discounting Factor&quot;</span><span class="p">,</span>
     <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
     <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/77d424587bdaea8042a0beaa0ccfd3bef678fd39cd98302b6d088fc5ff3a820c.png" src="_images/77d424587bdaea8042a0beaa0ccfd3bef678fd39cd98302b6d088fc5ff3a820c.png" />
</div>
</div>
</section>
<section id="bond-basis">
<h1>Bond Basis<a class="headerlink" href="#bond-basis" title="Link to this heading">#</a></h1>
<p>Bond basis is the additional spread to add on top of the discount curve to match the marked price of the bond. Bond basis can be a large topic, and can be calibrated on top of discount curve, or on top of a survival curve. Here, we assume this spread is added on top of the discount curve. Two special cases are worth mentioning,</p>
<ol class="arabic simple">
<li><p>In absence of recovery and survival probability, the bond basis is the same as Z-spread.</p></li>
<li><p>Theoretically, a “perfect” recovery curve and survival curve should make the bond basis equal to zero, if all credit risks are priced in.</p></li>
</ol>
<section id="z-spread">
<h2>Z-Spread<a class="headerlink" href="#z-spread" title="Link to this heading">#</a></h2>
<p>As mentioned, while calibrating Z-Spread, recovery rate and survival curve are not included, so we set them both to zeros. The <code class="docutils literal notranslate"><span class="pre">BondCurveAnalyticsHelper</span></code> creates a portfolio of bonds making easier to analyze the basket.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">analyticsHelper</span> <span class="o">=</span> <span class="n">BondCurveAnalyticsHelper</span><span class="p">(</span><span class="n">bonds</span><span class="p">)</span>
<span class="n">analyticsHelper</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span>
    <span class="n">settlement_dates</span><span class="o">=</span><span class="n">settlement_date</span><span class="p">,</span>
    <span class="n">discount_curves</span><span class="o">=</span><span class="n">discount_curve</span><span class="p">,</span>
    <span class="n">recovery_rates</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
    <span class="n">survival_curves</span><span class="o">=</span><span class="n">SurvivalCurveStep</span><span class="p">(</span><span class="n">anchor_date</span><span class="o">=</span><span class="n">valuation_date</span><span class="p">,</span>
                                     <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">valuation_date</span><span class="p">],</span>
                                     <span class="n">hazard_rates</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">],),</span>
<span class="p">)</span>
<span class="n">zspreads</span> <span class="o">=</span> <span class="n">analyticsHelper</span><span class="o">.</span><span class="n">get_bond_bases</span><span class="p">(</span>
    <span class="n">valuation_date</span><span class="o">=</span><span class="n">valuation_date</span><span class="p">,</span>
    <span class="n">dirty_prices</span><span class="o">=</span><span class="n">dirty_prices</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prettyTableByColumn</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;Numnber&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bonds</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;Bond&#39;</span><span class="p">:</span> <span class="n">bonds</span><span class="p">,</span>
        <span class="s1">&#39;Z-Spread (bps)&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">zspreads</span><span class="p">,</span> <span class="s1">&#39;.4%&#39;</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">align</span><span class="o">=</span><span class="s1">&#39;llr&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+---------+-----------------+----------------+
| Numnber | Bond            | Z-Spread (bps) |
+---------+-----------------+----------------+
| 1       | 5.750% 03/01/24 |        0.2011% |
| 2       | 5.875% 02/15/25 |        0.5341% |
| 3       | 3.625% 06/15/25 |        0.7554% |
| 4       | 3.625% 06/15/25 |        0.7554% |
| 5       | 4.375% 11/15/26 |        0.8962% |
| 6       | 4.875% 04/15/28 |        1.0160% |
| 7       | 5.875% 11/15/28 |        1.0303% |
| 8       | 6.375% 05/15/29 |        1.0973% |
| 9       | 5.375% 11/15/29 |        1.2124% |
| 10      | 4.875% 06/15/30 |        1.2557% |
+---------+-----------------+----------------+
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="bond-issuer-curve-nelson-siegel-svensson-form">
<h1>Bond Issuer Curve: Nelson Siegel Svensson Form<a class="headerlink" href="#bond-issuer-curve-nelson-siegel-svensson-form" title="Link to this heading">#</a></h1>
<p>The bond issuer curve, is essentially a survival curve calibrated from portfolio of bonds from the same issuer. When survival curve is constructed “perfectly”, the model price of the bond should match the market price, as it shou reflect the credit risks of the issuer on any time horizon.</p>
<p>The Nelson Siegel Svensson form is a parametric form of the survival curve, and therefore can be calibrated.</p>
<p>The calibration of the bond issuer curve will search the best parameters for the NS curve that minimizes the overall unexplained error between the model price and the market price for the portfolio of bonds. Bond basis, in this case, is the “error” term.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># modify the recovery rate and survival curve for analyticsHelper</span>
<span class="n">analyticsHelper</span><span class="o">.</span><span class="n">recovery_rates</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">analyticsHelper</span><span class="o">.</span><span class="n">survival_curves</span> <span class="o">=</span> <span class="n">SurvivalCurveNelsonSiegel</span><span class="p">(</span>
    <span class="n">anchor_date</span><span class="o">=</span><span class="n">valuation_date</span><span class="p">,</span>
    <span class="n">pivot_dates</span><span class="o">=</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2029</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">)],</span>
<span class="p">)</span>
<span class="n">analyticsHelper</span><span class="o">.</span><span class="n">valuation_date</span> <span class="o">=</span> <span class="n">valuation_date</span>

<span class="c1"># build the solver</span>
<span class="n">bondCurveSolver</span> <span class="o">=</span> <span class="n">BondCurveSolver</span><span class="p">(</span><span class="n">bondAnalyticsHelper</span><span class="o">=</span><span class="n">analyticsHelper</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optimal_survival_params</span> <span class="o">=</span> <span class="n">bondCurveSolver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span>
    <span class="n">dirty_prices</span><span class="o">=</span><span class="n">dirty_prices</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">optimal_survival_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 9.22536681e-05, -6.83825154e-02,  5.67154784e-02])
</pre></div>
</div>
</div>
</div>
<p>Plug in the calibrated optimal parameters into the NS curve, and check the unexplained error (bond basis) for each bond. Below chart shows a very good fit, the bond bases are all close to zero and evenly distributed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optimal_survival_curve</span> <span class="o">=</span> <span class="n">SurvivalCurveNelsonSiegel</span><span class="p">(</span>
    <span class="n">anchor_date</span><span class="o">=</span><span class="n">valuation_date</span><span class="p">,</span>
    <span class="n">pivot_dates</span><span class="o">=</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2029</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">)],</span>
    <span class="n">params</span><span class="o">=</span><span class="n">optimal_survival_params</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">analyticsHelper</span><span class="o">.</span><span class="n">survival_curves</span> <span class="o">=</span> <span class="n">optimal_survival_curve</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">analyticsHelper</span><span class="o">.</span><span class="n">get_bond_bases</span><span class="p">(</span>
    <span class="n">dirty_prices</span><span class="o">=</span><span class="n">dirty_prices</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">isplt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">maturity_date</span><span class="o">.</span><span class="n">_date</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bonds</span><span class="p">],</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">residuals</span><span class="p">,</span>
    <span class="n">y_axis_formatter</span><span class="o">=</span><span class="s2">&quot;percent&quot;</span><span class="p">,</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Bond Bases (Residuals) After Calibration&quot;</span><span class="p">,</span>
    <span class="n">x_label</span> <span class="o">=</span> <span class="s2">&quot;Maturity&quot;</span><span class="p">,</span>
    <span class="n">y_label</span> <span class="o">=</span> <span class="s2">&quot;Bond Basis&quot;</span><span class="p">,</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">[</span> <span class="n">b</span> <span class="o">/</span> <span class="mf">2e6</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">balance</span> <span class="p">],</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Bonds&quot;</span><span class="p">,</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2cb43a2aaf399985adb57a09dc7a9a900c48029148c610a4db72d9a087426865.png" src="_images/2cb43a2aaf399985adb57a09dc7a9a900c48029148c610a4db72d9a087426865.png" />
</div>
</div>
</section>
<section id="bond-curve-par-spreads">
<h1>Bond Curve Par Spreads<a class="headerlink" href="#bond-curve-par-spreads" title="Link to this heading">#</a></h1>
<p>With the calibrated continous survival curve, we can calculate the par spreads for sythetic CDSs with various maturities. And, ideally, these par spreads should be comparable to the CDS par spreads on the market.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tenors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;3m&quot;</span><span class="p">,</span> <span class="s2">&quot;6m&quot;</span><span class="p">,</span> <span class="s2">&quot;9m&quot;</span><span class="p">,</span> <span class="s2">&quot;1y&quot;</span><span class="p">,</span> <span class="s2">&quot;18m&quot;</span><span class="p">,</span> <span class="s2">&quot;2y&quot;</span><span class="p">,</span> <span class="s2">&quot;3y&quot;</span><span class="p">,</span> <span class="s2">&quot;4y&quot;</span><span class="p">,</span> <span class="s2">&quot;5y&quot;</span><span class="p">,</span> <span class="s2">&quot;7y&quot;</span><span class="p">,</span> <span class="s2">&quot;10y&quot;</span><span class="p">,</span> <span class="s2">&quot;15y&quot;</span><span class="p">,</span> <span class="s2">&quot;20y&quot;</span><span class="p">,</span> <span class="s2">&quot;30y&quot;</span><span class="p">]</span>
<span class="n">expiries</span> <span class="o">=</span> <span class="p">[</span><span class="n">Date</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">add_tenor</span><span class="p">(</span><span class="n">tenor</span><span class="p">)</span><span class="o">.</span><span class="n">_date</span> <span class="k">for</span> <span class="n">tenor</span> <span class="ow">in</span> <span class="n">tenors</span><span class="p">]</span>

<span class="n">par_spreads</span> <span class="o">=</span> <span class="n">cds_market_spreads</span><span class="p">(</span>
    <span class="n">discount_curve</span><span class="o">=</span><span class="n">discount_curve</span><span class="p">,</span>
    <span class="n">survival_curve</span><span class="o">=</span><span class="n">optimal_survival_curve</span><span class="p">,</span>
    <span class="n">recovery_rate</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
    <span class="n">expiries</span><span class="o">=</span><span class="n">expiries</span><span class="p">,</span>
    <span class="n">cds_style</span><span class="o">=</span><span class="s2">&quot;CORP_NA&quot;</span><span class="p">,</span>
    <span class="n">granularity</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">isplt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">tenors</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">par_spreads</span><span class="p">,</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;CDS Par Spreads from Bond Curve&quot;</span><span class="p">,</span>
    <span class="n">x_label</span> <span class="o">=</span> <span class="s2">&quot;Maturity&quot;</span><span class="p">,</span>
    <span class="n">y_label</span> <span class="o">=</span> <span class="s2">&quot;Par Spread&quot;</span><span class="p">,</span>
    <span class="n">y_axis_formatter</span><span class="o">=</span><span class="s2">&quot;bps&quot;</span><span class="p">,</span>
    <span class="n">x_tick_labels</span> <span class="o">=</span> <span class="n">tenors</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c6958e8689663e7e8d2e2e7f76afec9f3564f6dc30a9fd983e1fac32d9cb7138.png" src="_images/c6958e8689663e7e8d2e2e7f76afec9f3564f6dc30a9fd983e1fac32d9cb7138.png" />
</div>
</div>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">finpricing</p>
      </div>
    </a>
    <a class="right-next"
       href="changelog.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Changelog</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Read Reference and Market Data</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#bond-basis">Bond Basis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#z-spread">Z-Spread</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#bond-issuer-curve-nelson-siegel-svensson-form">Bond Issuer Curve: Nelson Siegel Svensson Form</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#bond-curve-par-spreads">Bond Curve Par Spreads</a></li>
</ul>

  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="_sources/bond_issuer_curve.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2023, Yiming Zhang.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>